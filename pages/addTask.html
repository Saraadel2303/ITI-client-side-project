<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css" />
    <title>Add Task</title>
  </head>
  <body class="container py-5">
    <h3 class="mb-4">Add New Task</h3>
    <form id="taskForm">
      <div class="row g-3">
        <div class="col-md-6">
          <label for="title" class="form-label">Task Title</label>
          <input type="text" class="form-control" id="title" required />
        </div>
        <div class="col-md-6">
          <label for="priority" class="form-label">Priority</label>
          <select class="form-select" id="priority" required>
            <option value="Low">Low</option>
            <option value="Medium" selected>Medium</option>
            <option value="High">High</option>
          </select>
        </div>

        <div class="col-12">
          <label for="description" class="form-label">Description</label>
          <textarea class="form-control" id="description" rows="3" maxlength="100"></textarea>
        </div>

        <div class="col-md-6">
          <label for="deadline" class="form-label">Deadline</label>
          <input type="date" class="form-control" id="deadline" required />
        </div>

        <!-- Ù‡Ù†Ø§ Ù‡Ù†ØºÙŠØ± Ù…Ù† input text Ù„Ø¯Ø±ÙˆØ¨ Ù„ÙŠØ³Øª -->
        <div class="col-md-6">
          <label for="assignees" class="form-label">Assign To</label>
          <select class="form-select" id="assignees" required>
            <option value="">-- Select Employee --</option>
          </select>
        </div>

        <div class="col-md-6">
          <label for="status" class="form-label">Status</label>
          <select class="form-select" id="status">
            <option value="To Do" selected>To Do</option>
            <!-- <option value="In Progress">In Progress</option>
            <option value="Blocked">Blocked</option>
            <option value="Completed">Completed</option> -->
          </select>
        </div>
      </div>

      <div class="mt-4 d-flex gap-2">
        <button type="submit" class="btn btn-success">Save Task</button>
        <a href="teamTasks.html" class="btn btn-secondary">Cancel</a>
      </div>
    </form>

    <script>
      // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø± Ø­Ø³Ø¨ Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ù„Ù Ø¹Ù†Ø¯Ùƒ
      const dataPath = "../data/data1.json";

      const assigneeSelect = document.getElementById("assignees");
      const taskForm = document.getElementById("taskForm");

      // --- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ---
      fetch(dataPath)
        .then((res) => {
          console.log("âœ… Response object:", res);
          return res.json();
        })
        .then((data) => {
          console.log("ğŸ“‚ Full data from JSON:", data);

          const employees = data.employees;
          console.log("ğŸ‘¥ All employees:", employees);

          const filteredEmployees = employees.filter(
            (emp) => emp.role === "Employee"
          );
          console.log(
            "âœ… Filtered employees (role=Employee):",
            filteredEmployees
          );

          filteredEmployees.forEach((emp) => {
            console.log(`â• Adding option: [id=${emp.id}] ${emp.name}`);

            const option = document.createElement("option");
            option.value = emp.id; // Ù†Ø®Ø²Ù† ID
            option.textContent = emp.name; // Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù…
            assigneeSelect.appendChild(option);
          });

          console.log("ğŸ‰ All employee options added to dropdown.");
        })
        .catch((err) => console.error("âŒ Error loading employees:", err));

      // --- ØªØ®Ø²ÙŠÙ† Ø§Ù„ØªØ§Ø³Ùƒ ÙÙŠ localStorage ---
      taskForm.addEventListener("submit", function (e) {
        e.preventDefault();

        // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚ÙŠÙ… Ù…Ù† Ø§Ù„ÙÙˆØ±Ù…
        const task = {
          id: Date.now(), // ID ÙØ±ÙŠØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ‚Øª
          title: document.getElementById("title").value,
          priority: document.getElementById("priority").value,
          description: document.getElementById("description").value,
          deadline: document.getElementById("deadline").value,
          assigneeId: document.getElementById("assignees").value,
          status: document.getElementById("status").value,
        };

        console.log("ğŸ“ New task object:", task);

        // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ÙƒÙˆÙ„ÙŠÙƒØ´Ù† Ù…Ù† Ø§Ù„ÙƒØ§Ø´ Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Array Ø¬Ø¯ÙŠØ¯
        let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

        console.log("ğŸ“¦ Current cached tasks:", tasks);

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ø³Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        tasks.push(task);
        console.log("â• Task added to collection:", task);

        // Ø­ÙØ¸ Ø§Ù„ÙƒÙˆÙ„ÙŠÙƒØ´Ù† ÙÙŠ Ø§Ù„ÙƒØ§Ø´
        localStorage.setItem("tasks", JSON.stringify(tasks));
        console.log("ğŸ’¾ Tasks collection saved in localStorage.");

        alert("âœ… Task saved successfully!");
        taskForm.reset(); // Ù…Ø³Ø­ Ø§Ù„ÙÙˆØ±Ù… Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸
      });
    </script>

    <script src="../bootstrap/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
